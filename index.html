<html>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet" />
<style>

@import url('https://fonts.googleapis.com/css2?family=Festive&family=Rampart+One&display=swap');

  * {
    margin: 0%;
    padding: 0%;
  }

  body{
    background-color: rgb(223, 249, 255);
    /* background-color: rgb(255, 255, 255); */
  }
  
  button{
    cursor: pointer;
  }

  .active{
    color: rgb(0, 0, 120);
  }
  #talkeractive{
    color: rgb(200, 0, 0);
  }

  #Logo {
    font-size: 4.5vw;
    text-align: center;
    padding: 1%;
    /* font-family: 'ZCOOL KuaiLe', cursive; */
    color: rgb(120, 0, 0);
  }
  #Logo:hover{
    color: rgb(200, 0, 0);
  }

  #container {
    width: 99vw;
    margin: auto;
    height: 100%;
    overflow-y: auto;
    /* background-color:rgb(242, 242, 242); */
  }

  .main-container {
    max-width: 99vw;
    /* border: 2px solid black; */
    /* border-radius: 13px; */
    margin: auto;
    height: 100%;
    /* overflow-y: auto; */
    /* background-color: rgb(242, 242, 242); */
    display: flex;
    flex-direction: column;
  }

  .message {
    /* background-color: rgb(211, 204, 204); */
    max-width: 80%;
    padding: 10px;
    margin: 2% 5%;
    border: 2px solid black;
    border-radius: 10px;
    font-size: 4vw;
    word-wrap: break-word;
  }

  .left {
    float: left;
    clear: both;
  }

  .right {
    float: right;
    clear: both;
  }

  #send-container {
    display: block;
    text-align: center;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 1%;
  }

  #m {
    width: 90vw;
    border: 2px solid black;
    border-radius: 6px;
    height: 8vw;
    font-size: 5vw;
    outline: none;
  }

  #submitButton {
    margin: 0 1%;
    width: 8vw;
    cursor: pointer;
    border: 2px solid black;
    font-size: 5vw;
    border-radius: 6px;
    height: 8vw;
    text-align: center;
  }

  nav{
    display: flex;
    justify-content:space-between;
    align-items:center;
    background:none;
  }

  nav button{
    height: 10vw;
    width: 20vw;
    font-size: 2.5vw;
    border-style: none;
    background:none;
    font-family: 'Rampart One', cursive;
    color: rgb(0, 0, 0);
  }

  nav button:hover{
    color: rgb(0, 0, 120);
    /* color: rgb(200, 200, 200); */
  }

  .msg-box-1{
    display: flex;
    height: 10vw;
    text-align: center;
    font-size: 2vw;
    align-items: center;
    border: 1px solid black;
    /* border-radius: 10px; */
    background-color: rgb(186, 229, 232);
    /* color: rgb(63, 63, 63); */
  }

  .msg-box-1 img{
    width: 10vw;
  }

  #back{
    font-size: 4vw;
    background:none;
    border-style: none;
    height: 8vw;
    padding-left: 1%;
    color: rgb(63, 63, 63);
    font-family: 'Festive', cursive;
  }

  .info{
    display: flex;
    flex-direction: column;
    width: 80vw;
  }

  .status{
    width: 15vw;
    text-align: center;
  }

  .name{
    text-align: start;
    padding: 0 1%;
  }

</style>

<body>
  <div id="container1">
    <nav>
      <button><h1 class="active">Chats</h1></button>
      <button><h1>Calls</h1></button>
      <button><h1 id="Logo">Talkers</h1></button>
      <!-- <button><img src="" alt="img"></button> -->
      <button><h1>Play</h1></button>
      <button><h1>Search</h1></button>
    </nav>
    <!-- <hr> -->
    <div class="main-container">
      <div class="msg-box-1">
          <button id="back">&lt;</button>
          <!-- <button><img src="" alt="img"></button> -->
          <div class="info">
              <h1 class="name">ROBO</h1>
          </div>
          <!-- <h1 class="status">Seen</h1> -->
      </div>
      <!-- <hr> -->
      <div id="container">
      </div>
      <form id="send-container">
        <input type="text" id="m">
        <input type="submit" id="submitButton" value="&gt;" />
      </form>
    </div>
  </div>
</body>

<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment.min.js"></script>

<script>
  let userName = "";
  let room = "1";

  while (userName == "" || userName == null) {
    userName = prompt("whats your name");
  }
  while (room == "" || room == null) {
    room = prompt("password");
  }

  let ID = "";
  var socket = io();
  //send event that user has joined room
  socket.emit("join room", { username: userName, roomName: room });
  socket.emit("new user", {
    value: document.getElementById("m").value,
    user: userName,

  });

  //receive data from server.
  socket.on('send data', (data) => {
    ID = data.id; //ID will be used later
    console.log(" my ID:" + ID);
  })
  $("#m").focus();
  //when form is submitted, capture the input value and then send it to server
  document
    .getElementsByTagName("form")[0]
    .addEventListener("submit", function (event) {
      event.preventDefault();
      socket.emit("chat message", {
        value: document.getElementById("m").value,
        user: userName,

      });

      document.getElementById("m").value = "";
    });
  socket.on("chat message", (data) => {
    if(data.data.value != ""){
      console.log(data.data.user + ": " + data.id);
      displayMessage(data);
    }
  });
  socket.on("new user", (data) => {
    broadcast(data);
  });

  function displayMessage(data) {
    let authorClass = "";
    let divClass = ""
    //verify that the user ID and the message sent ID is similar 
    if (data.id === ID) {
      console.log("This person has sent a message")
      authorClass = "You";
      divClass = "right";
    } else {
      authorClass = data.data.user;
      divClass = "left";
    }
    const div = document.createElement("div");
    div.className = divClass;
    // const li = document.createElement("li");
    // const p = document.createElement("p");
    // p.className = "time";
    div.innerText = authorClass + ":" + data.data.value;
    div.classList.add('message');
    // div.innerHTML =
    // '<p class="' +
    // authorClass +
    // '">' +
    // data.data.user +
    // "</p>" +
    // '<p class="message"> ' +
    // data.data.value +
    // "</p>";
    // div.appendChild(p);
    // li.appendChild(div);

    document.getElementById("container").appendChild(div);
    //scroll to the bottom
    document.getElementById("container").scrollTo(0, document.getElementById("container").scrollHeight);
  }

  function broadcast(data) {
    if (data.data.user != userName) {

      const div = document.createElement("div");
      div.className = "left";
      div.innerText = data.data.user + " has joined the chat.";
      div.classList.add('message');

      document.getElementById("container").appendChild(div);
      //scroll to the bottom
      document.getElementById("container").scrollTo(0, document.getElementById("container").scrollHeight);
    }
  }
</script>

</html>